#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
年龄识别优化配置
专门针对年龄识别准确性的配置参数
"""

# 图像质量配置（专门为人脸识别优化）
AGE_RECOGNITION_CONFIG = {
    # 前端图像质量
    "min_jpeg_quality": 0.75,     # 最低JPEG质量（提高到0.75）
    "max_jpeg_quality": 0.95,     # 最高JPEG质量（提高到0.95）
    "initial_jpeg_quality": 0.85,  # 初始JPEG质量
    
    # 图像分辨率
    "min_scale": 0.85,            # 最低分辨率缩放（提高到0.85）
    "max_scale": 1.0,             # 最高分辨率缩放（允许原始分辨率）
    "initial_scale": 0.95,        # 初始分辨率缩放
    
    # 人脸检测频率
    "face_detection_interval": 4,  # 每4帧检测一次（提高频率）
    "min_detection_interval": 3,   # 最小检测间隔
    "max_detection_interval": 8,   # 最大检测间隔
    
    # 年龄历史记录
    "age_history_length": 20,      # 年龄历史记录长度（增加样本数量）
    "min_confidence_threshold": 0.65,  # 最低置信度阈值（提高）
    "quality_weight": 0.8,         # 质量权重（提高质量重要性）
    
    # 人脸质量要求
    "min_face_area": 4000,         # 最小人脸面积（提高到63x63）
    "optimal_face_area": 18000,    # 最佳人脸面积（提高到135x135）
    "min_sharpness": 250,          # 最小清晰度（提高）
    "optimal_sharpness": 1000,     # 最佳清晰度（提高）
    
    # 性能平衡
    "max_processing_time": 0.3,    # 最大处理时间（300ms，允许更多处理）
    "adaptive_adjustment_step": 0.015,  # 自适应调整步长（更精细步长）
    "performance_monitoring_window": 12,  # 性能监控窗口（增加）
}

# 年龄校正参数（基于实际测试数据优化）
AGE_CORRECTION_FACTORS = {
    "Male": {
        (0, 6): -2.2,     # 幼儿男性校正（更精细的年龄分段）
        (7, 12): -1.9,    # 儿童男性校正
        (13, 15): -1.4,   # 初中男性校正
        (16, 17): -1.1,   # 高中男性校正
        (18, 22): -0.8,   # 大学男性校正
        (23, 25): -0.5,   # 青年男性校正
        (26, 30): 0.2,    # 青年男性校正
        (31, 35): 0.5,    # 青壮年男性校正
        (36, 40): 1.0,    # 中年男性校正
        (41, 45): 1.5,    # 中年男性校正
        (46, 50): 2.3,    # 中老年男性校正
        (51, 55): 2.8,    # 中老年男性校正
        (56, 60): 3.7,    # 老年男性校正
        (61, 65): 4.3,    # 老年男性校正
        (66, 70): 5.0,    # 高龄男性校正
        (71, 80): 5.8,    # 高龄男性校正
        (81, 100): 6.5    # 高龄男性校正
    },
    "Female": {
        (0, 6): -1.8,     # 幼儿女性校正
        (7, 12): -1.6,    # 儿童女性校正
        (13, 15): -1.2,   # 初中女性校正
        (16, 17): -0.9,   # 高中女性校正
        (18, 22): -0.5,   # 大学女性校正
        (23, 25): -0.2,   # 青年女性校正
        (26, 30): 0.7,    # 青年女性校正
        (31, 35): 1.2,    # 青壮年女性校正
        (36, 40): 2.0,    # 中年女性校正
        (41, 45): 2.6,    # 中年女性校正
        (46, 50): 3.4,    # 中老年女性校正
        (51, 55): 4.2,    # 中老年女性校正
        (56, 60): 4.8,    # 老年女性校正
        (61, 65): 5.5,    # 老年女性校正
        (66, 70): 6.3,    # 高龄女性校正
        (71, 80): 7.0,    # 高龄女性校正
        (81, 100): 7.8    # 高龄女性校正
    }
}

# 年龄范围映射优化
IMPROVED_AGE_MAPPING = {
    '(0-2)': (1.5, 0.8, 0.78),    # (中值, 标准差, 基础置信度)
    '(4-6)': (5.0, 0.9, 0.88),
    '(8-12)': (10.0, 1.2, 0.92),
    '(15-20)': (17.5, 1.8, 0.88),
    '(25-32)': (28.5, 2.2, 0.96),
    '(38-43)': (40.5, 1.8, 0.96),
    '(48-53)': (50.5, 1.8, 0.92),
    '(60-100)': (72.0, 7.0, 0.78)
}

def get_age_config():
    """获取年龄识别配置"""
    return AGE_RECOGNITION_CONFIG

def get_age_correction_factors():
    """获取年龄校正因子"""
    return AGE_CORRECTION_FACTORS

def get_age_mapping():
    """获取年龄范围映射"""
    return IMPROVED_AGE_MAPPING
